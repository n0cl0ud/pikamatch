<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 1100" width="1400" height="1100" font-family="'Segoe UI', system-ui, -apple-system, sans-serif">

  <!-- ============================================================ -->
  <!--  DEFS: gradients, filters, patterns, markers                 -->
  <!-- ============================================================ -->
  <defs>
    <!-- Background gradient -->
    <linearGradient id="bgGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#0a0e1a"/>
      <stop offset="50%" stop-color="#0d1220"/>
      <stop offset="100%" stop-color="#0a0f1e"/>
    </linearGradient>

    <!-- Dot grid pattern -->
    <pattern id="dotGrid" x="0" y="0" width="24" height="24" patternUnits="userSpaceOnUse">
      <circle cx="12" cy="12" r="0.8" fill="#1e3a5f" opacity="0.35"/>
    </pattern>

    <!-- Card gradient -->
    <linearGradient id="cardGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#1a2744"/>
      <stop offset="100%" stop-color="#141e35"/>
    </linearGradient>

    <!-- Node gradients -->
    <linearGradient id="blueGrad" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#4facfe"/>
      <stop offset="100%" stop-color="#3b82f6"/>
    </linearGradient>
    <linearGradient id="greenGrad" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#00d2a0"/>
      <stop offset="100%" stop-color="#00b894"/>
    </linearGradient>
    <linearGradient id="redGrad" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#fb7185"/>
      <stop offset="100%" stop-color="#e11d48"/>
    </linearGradient>
    <linearGradient id="purpleGrad" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#a78bfa"/>
      <stop offset="100%" stop-color="#7c3aed"/>
    </linearGradient>
    <linearGradient id="purpleGradVert" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#a78bfa"/>
      <stop offset="100%" stop-color="#7c3aed"/>
    </linearGradient>
    <linearGradient id="orangeGrad" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#fbbf24"/>
      <stop offset="100%" stop-color="#f59e0b"/>
    </linearGradient>
    <linearGradient id="cyanGrad" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#22d3ee"/>
      <stop offset="100%" stop-color="#06b6d4"/>
    </linearGradient>
    <linearGradient id="pinkGrad" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#fb7185"/>
      <stop offset="100%" stop-color="#e11d48"/>
    </linearGradient>

    <!-- Glow filters -->
    <filter id="glowBlue" x="-30%" y="-30%" width="160%" height="160%">
      <feGaussianBlur in="SourceGraphic" stdDeviation="6" result="blur"/>
      <feFlood flood-color="#4facfe" flood-opacity="0.35" result="color"/>
      <feComposite in="color" in2="blur" operator="in" result="glow"/>
      <feMerge><feMergeNode in="glow"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
    <filter id="glowGreen" x="-30%" y="-30%" width="160%" height="160%">
      <feGaussianBlur in="SourceGraphic" stdDeviation="6" result="blur"/>
      <feFlood flood-color="#00d2a0" flood-opacity="0.3" result="color"/>
      <feComposite in="color" in2="blur" operator="in" result="glow"/>
      <feMerge><feMergeNode in="glow"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
    <filter id="glowRed" x="-30%" y="-30%" width="160%" height="160%">
      <feGaussianBlur in="SourceGraphic" stdDeviation="6" result="blur"/>
      <feFlood flood-color="#fb7185" flood-opacity="0.3" result="color"/>
      <feComposite in="color" in2="blur" operator="in" result="glow"/>
      <feMerge><feMergeNode in="glow"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
    <filter id="glowPurple" x="-30%" y="-30%" width="160%" height="160%">
      <feGaussianBlur in="SourceGraphic" stdDeviation="8" result="blur"/>
      <feFlood flood-color="#a78bfa" flood-opacity="0.4" result="color"/>
      <feComposite in="color" in2="blur" operator="in" result="glow"/>
      <feMerge><feMergeNode in="glow"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
    <filter id="glowOrange" x="-30%" y="-30%" width="160%" height="160%">
      <feGaussianBlur in="SourceGraphic" stdDeviation="6" result="blur"/>
      <feFlood flood-color="#fbbf24" flood-opacity="0.3" result="color"/>
      <feComposite in="color" in2="blur" operator="in" result="glow"/>
      <feMerge><feMergeNode in="glow"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
    <filter id="glowCyan" x="-30%" y="-30%" width="160%" height="160%">
      <feGaussianBlur in="SourceGraphic" stdDeviation="6" result="blur"/>
      <feFlood flood-color="#22d3ee" flood-opacity="0.3" result="color"/>
      <feComposite in="color" in2="blur" operator="in" result="glow"/>
      <feMerge><feMergeNode in="glow"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
    <filter id="glowPink" x="-30%" y="-30%" width="160%" height="160%">
      <feGaussianBlur in="SourceGraphic" stdDeviation="6" result="blur"/>
      <feFlood flood-color="#fb7185" flood-opacity="0.3" result="color"/>
      <feComposite in="color" in2="blur" operator="in" result="glow"/>
      <feMerge><feMergeNode in="glow"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>

    <!-- Drop shadow -->
    <filter id="dropShadow" x="-10%" y="-10%" width="130%" height="130%">
      <feDropShadow dx="0" dy="3" stdDeviation="4" flood-color="#000" flood-opacity="0.4"/>
    </filter>
    <filter id="dropShadowLg" x="-10%" y="-10%" width="130%" height="130%">
      <feDropShadow dx="0" dy="4" stdDeviation="6" flood-color="#000" flood-opacity="0.5"/>
    </filter>

    <!-- Arrow markers -->
    <marker id="arrowBlue" viewBox="0 0 12 12" refX="10" refY="6" markerWidth="10" markerHeight="10" orient="auto-start-reverse">
      <path d="M2,2 L10,6 L2,10 Z" fill="#4facfe"/>
    </marker>
    <marker id="arrowGreen" viewBox="0 0 12 12" refX="10" refY="6" markerWidth="10" markerHeight="10" orient="auto-start-reverse">
      <path d="M2,2 L10,6 L2,10 Z" fill="#00d2a0"/>
    </marker>
    <marker id="arrowRed" viewBox="0 0 12 12" refX="10" refY="6" markerWidth="10" markerHeight="10" orient="auto-start-reverse">
      <path d="M2,2 L10,6 L2,10 Z" fill="#fb7185"/>
    </marker>
    <marker id="arrowOrange" viewBox="0 0 12 12" refX="10" refY="6" markerWidth="10" markerHeight="10" orient="auto-start-reverse">
      <path d="M2,2 L10,6 L2,10 Z" fill="#fbbf24"/>
    </marker>
    <marker id="arrowGray" viewBox="0 0 12 12" refX="10" refY="6" markerWidth="10" markerHeight="10" orient="auto-start-reverse">
      <path d="M2,2 L10,6 L2,10 Z" fill="#5a6a8a"/>
    </marker>
    <marker id="arrowPurple" viewBox="0 0 12 12" refX="10" refY="6" markerWidth="10" markerHeight="10" orient="auto-start-reverse">
      <path d="M2,2 L10,6 L2,10 Z" fill="#a78bfa"/>
    </marker>
    <marker id="arrowCyan" viewBox="0 0 12 12" refX="10" refY="6" markerWidth="10" markerHeight="10" orient="auto-start-reverse">
      <path d="M2,2 L10,6 L2,10 Z" fill="#22d3ee"/>
    </marker>
    <marker id="arrowPink" viewBox="0 0 12 12" refX="10" refY="6" markerWidth="10" markerHeight="10" orient="auto-start-reverse">
      <path d="M2,2 L10,6 L2,10 Z" fill="#fb7185"/>
    </marker>
  </defs>

  <!-- ============================================================ -->
  <!--  BACKGROUND                                                  -->
  <!-- ============================================================ -->
  <rect width="1400" height="1100" fill="url(#bgGrad)"/>
  <rect width="1400" height="1100" fill="url(#dotGrid)"/>

  <!-- ============================================================ -->
  <!--  TITLE AREA                                                  -->
  <!-- ============================================================ -->
  <text x="700" y="42" text-anchor="middle" fill="#e2e8f0" font-size="26" font-weight="700" letter-spacing="6">INDEXATION PIPELINE</text>
  <text x="700" y="64" text-anchor="middle" fill="#64748b" font-size="11" font-weight="500" letter-spacing="4">PIKAMATCH  &#x2022;  PDF PROCESSING FLOW</text>
  <line x1="500" y1="76" x2="900" y2="76" stroke="#1e3a5f" stroke-width="1"/>

  <!-- ============================================================ -->
  <!--  MAIN CARD CONTAINER                                         -->
  <!-- ============================================================ -->
  <rect x="40" y="88" width="1320" height="920" rx="16" ry="16" fill="url(#cardGrad)" stroke="#1e3a5f" stroke-width="1" filter="url(#dropShadowLg)"/>

  <!-- ============================================================ -->
  <!--  ROW 1: PDF FILE INPUT (Blue)                                -->
  <!-- ============================================================ -->
  <g filter="url(#glowBlue)">
    <rect x="610" y="110" width="180" height="52" rx="10" ry="10" fill="url(#blueGrad)" filter="url(#dropShadow)"/>
  </g>
  <text x="700" y="133" text-anchor="middle" fill="#fff" font-size="14" font-weight="700">PDF File</text>
  <text x="700" y="150" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="10" font-weight="400">Input Document</text>

  <!-- Arrow: PDF -> PyMuPDF -->
  <line x1="700" y1="162" x2="700" y2="190" stroke="#4facfe" stroke-width="2" marker-end="url(#arrowBlue)"/>

  <!-- ============================================================ -->
  <!--  ROW 2: PyMuPDF Extract Images (Green)                       -->
  <!-- ============================================================ -->
  <g filter="url(#glowGreen)">
    <rect x="575" y="196" width="250" height="52" rx="10" ry="10" fill="url(#greenGrad)" filter="url(#dropShadow)"/>
  </g>
  <text x="700" y="219" text-anchor="middle" fill="#fff" font-size="14" font-weight="700">PyMuPDF Extract Images</text>
  <text x="700" y="236" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="10" font-weight="400">get_images() + get_image_rects()</text>

  <!-- Arrow: PyMuPDF -> Decision diamond -->
  <line x1="700" y1="248" x2="700" y2="278" stroke="#00d2a0" stroke-width="2" marker-end="url(#arrowGreen)"/>

  <!-- ============================================================ -->
  <!--  SIDE PATH: "No images found" dashed                         -->
  <!--  (drawn before diamond so the dashed line sits behind it)    -->
  <!-- ============================================================ -->
  <path d="M 575,222 L 310,222 L 310,350" fill="none" stroke="#5a6a8a" stroke-width="1.8" stroke-dasharray="6,4" marker-end="url(#arrowGray)"/>
  <text x="435" y="215" text-anchor="middle" fill="#64748b" font-size="10" font-style="italic">No images found</text>

  <!-- Render Page @ 200 DPI (Green) -->
  <g filter="url(#glowGreen)">
    <rect x="195" y="356" width="230" height="52" rx="10" ry="10" fill="url(#greenGrad)" filter="url(#dropShadow)"/>
  </g>
  <text x="310" y="379" text-anchor="middle" fill="#fff" font-size="14" font-weight="700">Render Page @ 200 DPI</text>
  <text x="310" y="396" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="10" font-weight="400">fitz page.get_pixmap()</text>

  <!-- Arrow: Render Page -> OpenCV Segment (side path) -->
  <line x1="310" y1="408" x2="310" y2="438" stroke="#00d2a0" stroke-width="2" marker-end="url(#arrowGreen)"/>

  <!-- OpenCV Segment (side path) (Red) -->
  <g filter="url(#glowRed)">
    <rect x="195" y="444" width="230" height="52" rx="10" ry="10" fill="url(#redGrad)" filter="url(#dropShadow)"/>
  </g>
  <text x="310" y="467" text-anchor="middle" fill="#fff" font-size="14" font-weight="700">OpenCV Segment</text>
  <text x="310" y="484" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="10" font-weight="400">Full-page segmentation</text>

  <!-- Arrow: side OpenCV -> Individual Images -->
  <path d="M 425,470 L 560,470 L 560,542 L 608,542" fill="none" stroke="#fb7185" stroke-width="2" marker-end="url(#arrowRed)"/>

  <!-- ============================================================ -->
  <!--  ROW 3: Decision Diamond (Orange)                            -->
  <!-- ============================================================ -->
  <g filter="url(#glowOrange)">
    <polygon points="700,284 830,340 700,396 570,340" fill="#141e35" stroke="url(#orangeGrad)" stroke-width="2.5" filter="url(#dropShadow)"/>
  </g>
  <text x="700" y="333" text-anchor="middle" fill="#fbbf24" font-size="12" font-weight="700">Image covers</text>
  <text x="700" y="350" text-anchor="middle" fill="#fbbf24" font-size="12" font-weight="700">&gt;60% of page?</text>

  <!-- YES arrow: Diamond right -> OpenCV Segment Sub-images -->
  <line x1="830" y1="340" x2="876" y2="340" stroke="#fbbf24" stroke-width="2" marker-end="url(#arrowOrange)"/>
  <text x="850" y="332" text-anchor="middle" fill="#fbbf24" font-size="10" font-weight="700">YES</text>

  <!-- NO arrow: Diamond bottom -> down to Individual Images -->
  <path d="M 700,396 L 700,518" fill="none" stroke="#fbbf24" stroke-width="2" marker-end="url(#arrowOrange)"/>
  <text x="715" y="418" text-anchor="start" fill="#fbbf24" font-size="10" font-weight="700">NO</text>

  <!-- ============================================================ -->
  <!--  ROW 3 RIGHT: OpenCV Segment Sub-images (Red)                -->
  <!-- ============================================================ -->
  <g filter="url(#glowRed)">
    <rect x="878" y="314" width="260" height="52" rx="10" ry="10" fill="url(#redGrad)" filter="url(#dropShadow)"/>
  </g>
  <text x="1008" y="337" text-anchor="middle" fill="#fff" font-size="14" font-weight="700">OpenCV Segment Sub-images</text>
  <text x="1008" y="354" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="10" font-weight="400">Contour detection + splitting</text>

  <!-- Arrow: OpenCV Segment Sub-images -> down to Individual Images -->
  <path d="M 1008,366 L 1008,470 L 792,470 L 792,518" fill="none" stroke="#fb7185" stroke-width="2" marker-end="url(#arrowRed)"/>

  <!-- ============================================================ -->
  <!--  ROW 4: Individual Images collector node                     -->
  <!-- ============================================================ -->
  <g filter="url(#dropShadow)">
    <rect x="610" y="520" width="180" height="44" rx="8" ry="8" fill="#1a2744" stroke="#3b82f6" stroke-width="1.5"/>
  </g>
  <text x="700" y="547" text-anchor="middle" fill="#94a3b8" font-size="13" font-weight="600">Individual Images</text>

  <!-- ============================================================ -->
  <!--  FAN-OUT ARROWS from Individual Images to 4 processing nodes -->
  <!-- ============================================================ -->
  <!-- Fan-out to CLIP (leftmost) -->
  <path d="M 635,564 L 250,610 L 250,630" fill="none" stroke="#fb7185" stroke-width="1.8" marker-end="url(#arrowPink)"/>
  <!-- Fan-out to pHash -->
  <path d="M 665,564 L 510,610 L 510,630" fill="none" stroke="#00d2a0" stroke-width="1.8" marker-end="url(#arrowGreen)"/>
  <!-- Fan-out to grayscale -->
  <path d="M 735,564 L 770,610 L 770,630" fill="none" stroke="#00d2a0" stroke-width="1.8" marker-end="url(#arrowGreen)"/>
  <!-- Fan-out to Qwen VLM -->
  <path d="M 765,564 L 1060,610 L 1060,630" fill="none" stroke="#22d3ee" stroke-width="1.8" marker-end="url(#arrowCyan)"/>

  <!-- ============================================================ -->
  <!--  ROW 5: Four parallel processing nodes                       -->
  <!-- ============================================================ -->

  <!-- 1. CLIP ViT-L/14 Embed (Pink/Red accent) -->
  <g filter="url(#glowPink)">
    <rect x="130" y="636" width="240" height="60" rx="10" ry="10" fill="url(#pinkGrad)" filter="url(#dropShadow)"/>
  </g>
  <text x="250" y="660" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">CLIP ViT-L/14</text>
  <text x="250" y="680" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="10" font-weight="400">Embed (768-dim vector)</text>

  <!-- 2. pHash 16x16 (Green) -->
  <g filter="url(#glowGreen)">
    <rect x="400" y="636" width="220" height="60" rx="10" ry="10" fill="url(#greenGrad)" filter="url(#dropShadow)"/>
  </g>
  <text x="510" y="660" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">pHash 16x16</text>
  <text x="510" y="680" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="10" font-weight="400">= 256-bit perceptual hash</text>

  <!-- 3. is_grayscale() B/W Detection (Green) -->
  <g filter="url(#glowGreen)">
    <rect x="650" y="636" width="240" height="60" rx="10" ry="10" fill="url(#greenGrad)" filter="url(#dropShadow)"/>
  </g>
  <text x="770" y="660" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">is_grayscale()</text>
  <text x="770" y="680" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="10" font-weight="400">B/W Detection</text>

  <!-- 4. Qwen2.5-VL Extract Description (Cyan) -->
  <g filter="url(#glowCyan)">
    <rect x="920" y="636" width="280" height="60" rx="10" ry="10" fill="url(#cyanGrad)" filter="url(#dropShadow)"/>
  </g>
  <text x="1060" y="660" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">Qwen3-VL-8B</text>
  <text x="1060" y="680" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="10" font-weight="400">Extract Description (JSON)</text>

  <!-- ============================================================ -->
  <!--  CONVERGENCE ARROWS: 4 nodes -> Qdrant cylinder top          -->
  <!-- ============================================================ -->
  <path d="M 250,696 L 250,745 L 650,793" fill="none" stroke="#a78bfa" stroke-width="1.8" marker-end="url(#arrowPurple)"/>
  <path d="M 510,696 L 510,745 L 665,793" fill="none" stroke="#a78bfa" stroke-width="1.8" marker-end="url(#arrowPurple)"/>
  <path d="M 770,696 L 770,745 L 730,793" fill="none" stroke="#a78bfa" stroke-width="1.8" marker-end="url(#arrowPurple)"/>
  <path d="M 1060,696 L 1060,745 L 750,793" fill="none" stroke="#a78bfa" stroke-width="1.8" marker-end="url(#arrowPurple)"/>

  <!-- ============================================================ -->
  <!--  ROW 6: Qdrant Store (Purple, cylinder / DB shape)           -->
  <!-- ============================================================ -->
  <g filter="url(#glowPurple)">
    <g filter="url(#dropShadow)">
      <!-- Cylinder body -->
      <path d="M 580,808 L 580,868 A 120,18 0 0,0 820,868 L 820,808" fill="url(#purpleGradVert)" stroke="none"/>
      <!-- Cylinder side strokes -->
      <line x1="580" y1="808" x2="580" y2="868" stroke="#8b5cf6" stroke-width="1" opacity="0.5"/>
      <line x1="820" y1="808" x2="820" y2="868" stroke="#8b5cf6" stroke-width="1" opacity="0.5"/>
      <!-- Cylinder bottom ellipse -->
      <ellipse cx="700" cy="868" rx="120" ry="18" fill="#6d28d9" stroke="#8b5cf6" stroke-width="1" opacity="0.7"/>
      <!-- Cylinder top ellipse (lid) -->
      <ellipse cx="700" cy="808" rx="120" ry="18" fill="#a78bfa" stroke="#c4b5fd" stroke-width="1" opacity="0.85"/>
    </g>
  </g>
  <text x="700" y="840" text-anchor="middle" fill="#fff" font-size="15" font-weight="700">Qdrant</text>
  <text x="700" y="858" text-anchor="middle" fill="rgba(255,255,255,0.75)" font-size="11" font-weight="400">Store Vector + Payload</text>

  <!-- ============================================================ -->
  <!--  LEGEND                                                      -->
  <!-- ============================================================ -->
  <g transform="translate(140, 930)">
    <!-- Legend background -->
    <rect x="0" y="0" width="1120" height="50" rx="8" ry="8" fill="#0f1729" stroke="#1e3a5f" stroke-width="1" opacity="0.85"/>

    <!-- Input -->
    <rect x="30" y="16" width="18" height="18" rx="4" fill="url(#blueGrad)"/>
    <text x="56" y="30" fill="#94a3b8" font-size="11" font-weight="600">Input</text>

    <!-- Processing -->
    <rect x="130" y="16" width="18" height="18" rx="4" fill="url(#greenGrad)"/>
    <text x="156" y="30" fill="#94a3b8" font-size="11" font-weight="600">Processing</text>

    <!-- OpenCV -->
    <rect x="280" y="16" width="18" height="18" rx="4" fill="url(#redGrad)"/>
    <text x="306" y="30" fill="#94a3b8" font-size="11" font-weight="600">OpenCV Segmentation</text>

    <!-- Decision -->
    <polygon points="480,25 490,16 500,25 490,34" fill="none" stroke="#fbbf24" stroke-width="2"/>
    <text x="510" y="30" fill="#94a3b8" font-size="11" font-weight="600">Decision</text>

    <!-- VLM -->
    <rect x="610" y="16" width="18" height="18" rx="4" fill="url(#cyanGrad)"/>
    <text x="636" y="30" fill="#94a3b8" font-size="11" font-weight="600">VLM</text>

    <!-- CLIP -->
    <rect x="710" y="16" width="18" height="18" rx="4" fill="url(#pinkGrad)"/>
    <text x="736" y="30" fill="#94a3b8" font-size="11" font-weight="600">CLIP Embedding</text>

    <!-- Vector DB -->
    <ellipse cx="895" cy="25" rx="12" ry="8" fill="url(#purpleGrad)" stroke="#a78bfa" stroke-width="1"/>
    <text x="915" y="30" fill="#94a3b8" font-size="11" font-weight="600">Vector DB</text>
  </g>

  <!-- ============================================================ -->
  <!--  FOOTER                                                      -->
  <!-- ============================================================ -->
  <line x1="140" y1="1005" x2="1260" y2="1005" stroke="#1e3a5f" stroke-width="1"/>
  <text x="700" y="1025" text-anchor="middle" fill="#475569" font-size="10" font-weight="400" letter-spacing="2">PIKAMATCH INDEXATION FLOW  &#x2022;  v1.0</text>

</svg>