<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 700" font-family="'Segoe UI', system-ui, -apple-system, sans-serif">
<defs>
  <!-- Background gradient -->
  <linearGradient id="bg" x1="0" y1="0" x2="1" y2="1">
    <stop offset="0%" stop-color="#0a0e1a"/>
    <stop offset="50%" stop-color="#0d1220"/>
    <stop offset="100%" stop-color="#0a0f1e"/>
  </linearGradient>
  <!-- Card gradient -->
  <linearGradient id="cardBlue" x1="0" y1="0" x2="0" y2="1">
    <stop offset="0%" stop-color="#1a2744" stop-opacity="0.9"/>
    <stop offset="100%" stop-color="#141e35" stop-opacity="0.95"/>
  </linearGradient>
  <!-- Node gradients -->
  <linearGradient id="gradGreen" x1="0" y1="0" x2="1" y2="1">
    <stop offset="0%" stop-color="#00d2a0"/><stop offset="100%" stop-color="#00b894"/>
  </linearGradient>
  <linearGradient id="gradBlue" x1="0" y1="0" x2="1" y2="1">
    <stop offset="0%" stop-color="#4facfe"/><stop offset="100%" stop-color="#3b82f6"/>
  </linearGradient>
  <linearGradient id="gradPurple" x1="0" y1="0" x2="1" y2="1">
    <stop offset="0%" stop-color="#a78bfa"/><stop offset="100%" stop-color="#7c3aed"/>
  </linearGradient>
  <linearGradient id="gradOrange" x1="0" y1="0" x2="1" y2="1">
    <stop offset="0%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#f59e0b"/>
  </linearGradient>
  <linearGradient id="gradRed" x1="0" y1="0" x2="1" y2="1">
    <stop offset="0%" stop-color="#fb7185"/><stop offset="100%" stop-color="#e11d48"/>
  </linearGradient>
  <linearGradient id="gradCyan" x1="0" y1="0" x2="1" y2="1">
    <stop offset="0%" stop-color="#22d3ee"/><stop offset="100%" stop-color="#06b6d4"/>
  </linearGradient>
  <linearGradient id="gradGray" x1="0" y1="0" x2="1" y2="1">
    <stop offset="0%" stop-color="#64748b"/><stop offset="100%" stop-color="#475569"/>
  </linearGradient>
  <!-- Glow filters -->
  <filter id="glowGreen" x="-30%" y="-30%" width="160%" height="160%">
    <feGaussianBlur stdDeviation="6" result="blur"/><feFlood flood-color="#00d2a0" flood-opacity="0.3"/><feComposite in2="blur" operator="in"/><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>
  </filter>
  <filter id="glowBlue" x="-30%" y="-30%" width="160%" height="160%">
    <feGaussianBlur stdDeviation="6" result="blur"/><feFlood flood-color="#4facfe" flood-opacity="0.3"/><feComposite in2="blur" operator="in"/><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>
  </filter>
  <filter id="glowPurple" x="-30%" y="-30%" width="160%" height="160%">
    <feGaussianBlur stdDeviation="6" result="blur"/><feFlood flood-color="#a78bfa" flood-opacity="0.3"/><feComposite in2="blur" operator="in"/><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>
  </filter>
  <filter id="glowOrange" x="-30%" y="-30%" width="160%" height="160%">
    <feGaussianBlur stdDeviation="6" result="blur"/><feFlood flood-color="#fbbf24" flood-opacity="0.35"/><feComposite in2="blur" operator="in"/><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>
  </filter>
  <filter id="glowRed" x="-30%" y="-30%" width="160%" height="160%">
    <feGaussianBlur stdDeviation="6" result="blur"/><feFlood flood-color="#fb7185" flood-opacity="0.3"/><feComposite in2="blur" operator="in"/><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>
  </filter>
  <filter id="glowCyan" x="-30%" y="-30%" width="160%" height="160%">
    <feGaussianBlur stdDeviation="6" result="blur"/><feFlood flood-color="#22d3ee" flood-opacity="0.3"/><feComposite in2="blur" operator="in"/><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>
  </filter>
  <!-- Shadow filters -->
  <filter id="shadowCard" x="-10%" y="-10%" width="125%" height="125%">
    <feDropShadow dx="0" dy="4" stdDeviation="12" flood-color="#000" flood-opacity="0.4"/>
  </filter>
  <filter id="shadowSmall" x="-10%" y="-10%" width="120%" height="120%">
    <feDropShadow dx="0" dy="2" stdDeviation="4" flood-color="#000" flood-opacity="0.3"/>
  </filter>
  <!-- Arrow markers -->
  <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
    <path d="M 0 1 L 10 5 L 0 9 z" fill="#475569"/>
  </marker>
  <marker id="arrowGreen" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
    <path d="M 0 1 L 10 5 L 0 9 z" fill="#00d2a0"/>
  </marker>
  <marker id="arrowPurple" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
    <path d="M 0 1 L 10 5 L 0 9 z" fill="#a78bfa"/>
  </marker>
  <marker id="arrowOrange" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
    <path d="M 0 1 L 10 5 L 0 9 z" fill="#fbbf24"/>
  </marker>
  <marker id="arrowRed" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
    <path d="M 0 1 L 10 5 L 0 9 z" fill="#fb7185"/>
  </marker>
  <marker id="arrowBlue" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
    <path d="M 0 1 L 10 5 L 0 9 z" fill="#4facfe"/>
  </marker>
  <marker id="arrowCyan" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
    <path d="M 0 1 L 10 5 L 0 9 z" fill="#22d3ee"/>
  </marker>
  <marker id="arrowDim" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
    <path d="M 0 1 L 10 5 L 0 9 z" fill="#334155"/>
  </marker>
  <!-- Dot pattern -->
  <pattern id="dots" x="0" y="0" width="30" height="30" patternUnits="userSpaceOnUse">
    <circle cx="15" cy="15" r="0.7" fill="#1e293b" opacity="0.6"/>
  </pattern>
</defs>

<!-- ============================================================ -->
<!-- BACKGROUND                                                    -->
<!-- ============================================================ -->
<rect width="1400" height="700" fill="url(#bg)"/>
<rect width="1400" height="700" fill="url(#dots)"/>

<!-- ============================================================ -->
<!-- TITLE                                                         -->
<!-- ============================================================ -->
<text x="700" y="38" text-anchor="middle" fill="#e2e8f0" font-size="20" font-weight="700" letter-spacing="4">SEARCH PIPELINE</text>
<text x="700" y="58" text-anchor="middle" fill="#64748b" font-size="11" font-weight="500" letter-spacing="3">PIKAMATCH  &#x2022;  INSTANT QUERY FLOW</text>

<!-- Decorative line under title -->
<line x1="560" y1="68" x2="840" y2="68" stroke="#1e3a5f" stroke-width="1" opacity="0.5"/>

<!-- ============================================================ -->
<!-- CARD CONTAINER — Phase 1: Embedding                          -->
<!-- ============================================================ -->
<rect x="200" y="85" width="370" height="200" rx="12" fill="url(#cardBlue)" stroke="#1e3a5f" stroke-width="1" filter="url(#shadowCard)"/>
<text x="385" y="108" text-anchor="middle" fill="#64748b" font-size="10" font-weight="600" letter-spacing="2">PHASE 1 — EMBEDDING</text>

<!-- ============================================================ -->
<!-- CARD CONTAINER — Phase 2: Decision + Weighting               -->
<!-- ============================================================ -->
<rect x="620" y="85" width="340" height="530" rx="12" fill="url(#cardBlue)" stroke="#1e3a5f" stroke-width="1" filter="url(#shadowCard)"/>
<text x="790" y="108" text-anchor="middle" fill="#64748b" font-size="10" font-weight="600" letter-spacing="2">PHASE 2 — SCORING</text>

<!-- ============================================================ -->
<!-- CARD CONTAINER — Phase 3: Results                            -->
<!-- ============================================================ -->
<rect x="1010" y="85" width="360" height="340" rx="12" fill="url(#cardBlue)" stroke="#1e3a5f" stroke-width="1" filter="url(#shadowCard)"/>
<text x="1190" y="108" text-anchor="middle" fill="#64748b" font-size="10" font-weight="600" letter-spacing="2">PHASE 3 — RESULTS</text>

<!-- ============================================================ -->
<!-- NODE: Query Image (Orange)                                    -->
<!-- ============================================================ -->
<g filter="url(#glowOrange)">
  <rect x="30" y="260" width="150" height="80" rx="10" fill="url(#gradOrange)" filter="url(#shadowSmall)"/>
  <text x="105" y="293" text-anchor="middle" fill="#1a1a2e" font-size="14" font-weight="700">Query Image</text>
  <text x="105" y="312" text-anchor="middle" fill="#1a1a2e" font-size="11" font-weight="500" opacity="0.8">JPG / PNG</text>
</g>

<!-- ============================================================ -->
<!-- NODE: CLIP ViT-L/14 Embed (Red/Pink)                          -->
<!-- ============================================================ -->
<g filter="url(#glowRed)">
  <rect x="228" y="125" width="165" height="65" rx="8" fill="url(#gradRed)" filter="url(#shadowSmall)"/>
  <text x="310" y="153" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">CLIP ViT-L/14</text>
  <text x="310" y="172" text-anchor="middle" fill="#fff" font-size="10" font-weight="500" opacity="0.85">CLAHE + Multi-scale</text>
</g>

<!-- ============================================================ -->
<!-- NODE: pHash Compute (Green)                                   -->
<!-- ============================================================ -->
<g filter="url(#glowGreen)">
  <rect x="228" y="205" width="165" height="55" rx="8" fill="url(#gradGreen)" filter="url(#shadowSmall)"/>
  <text x="310" y="228" text-anchor="middle" fill="#1a1a2e" font-size="13" font-weight="700">pHash Compute</text>
  <text x="310" y="245" text-anchor="middle" fill="#1a1a2e" font-size="10" font-weight="500" opacity="0.75">16x16 = 256-bit</text>
</g>

<!-- ============================================================ -->
<!-- NODE: is_grayscale() (Green)                                  -->
<!-- ============================================================ -->
<g filter="url(#glowGreen)">
  <rect x="228" y="425" width="165" height="55" rx="8" fill="url(#gradGreen)" filter="url(#shadowSmall)"/>
  <text x="310" y="449" text-anchor="middle" fill="#1a1a2e" font-size="13" font-weight="700">is_grayscale()</text>
  <text x="310" y="466" text-anchor="middle" fill="#1a1a2e" font-size="10" font-weight="500" opacity="0.75">B/W Detection</text>
</g>

<!-- ============================================================ -->
<!-- NODE: Qdrant ANN Search + tag filter (Purple)                 -->
<!-- ============================================================ -->
<g filter="url(#glowPurple)">
  <rect x="420" y="120" width="130" height="75" rx="8" fill="url(#gradPurple)" filter="url(#shadowSmall)"/>
  <text x="485" y="147" text-anchor="middle" fill="#fff" font-size="12" font-weight="700">Qdrant ANN</text>
  <text x="485" y="163" text-anchor="middle" fill="#fff" font-size="10" font-weight="500" opacity="0.85">Search</text>
  <text x="485" y="179" text-anchor="middle" fill="#fff" font-size="10" font-weight="500" opacity="0.85">+ tag filter</text>
</g>

<!-- ============================================================ -->
<!-- DIAMOND: Color Mismatch? (Orange border)                      -->
<!-- ============================================================ -->
<g filter="url(#glowOrange)">
  <polygon points="790,440 870,500 790,560 710,500" fill="#141e35" stroke="#fbbf24" stroke-width="2" filter="url(#shadowSmall)"/>
  <text x="790" y="495" text-anchor="middle" fill="#fbbf24" font-size="12" font-weight="700">Color</text>
  <text x="790" y="511" text-anchor="middle" fill="#fbbf24" font-size="12" font-weight="700">Mismatch?</text>
</g>

<!-- ============================================================ -->
<!-- NODE: 60% CLIP / 40% pHash (Green) — "Same" path             -->
<!-- ============================================================ -->
<g filter="url(#glowGreen)">
  <rect x="645" y="295" width="145" height="60" rx="8" fill="url(#gradGreen)" filter="url(#shadowSmall)"/>
  <text x="717" y="320" text-anchor="middle" fill="#1a1a2e" font-size="13" font-weight="700">60% CLIP</text>
  <text x="717" y="339" text-anchor="middle" fill="#1a1a2e" font-size="13" font-weight="700">40% pHash</text>
</g>

<!-- ============================================================ -->
<!-- NODE: 85% CLIP / 15% pHash (Red) — "Different" path           -->
<!-- ============================================================ -->
<g filter="url(#glowRed)">
  <rect x="645" y="155" width="145" height="60" rx="8" fill="url(#gradRed)" filter="url(#shadowSmall)"/>
  <text x="717" y="180" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">85% CLIP</text>
  <text x="717" y="199" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">15% pHash</text>
</g>

<!-- ============================================================ -->
<!-- NODE: Re-rank CLIP + pHash (Cyan)                             -->
<!-- ============================================================ -->
<g filter="url(#glowCyan)">
  <rect x="1040" y="155" width="175" height="70" rx="10" fill="url(#gradCyan)" filter="url(#shadowSmall)"/>
  <text x="1127" y="184" text-anchor="middle" fill="#1a1a2e" font-size="14" font-weight="700">Re-rank</text>
  <text x="1127" y="204" text-anchor="middle" fill="#1a1a2e" font-size="11" font-weight="600">CLIP + pHash</text>
</g>

<!-- ============================================================ -->
<!-- NODE: Results + Pre-computed Descriptions (Blue)               -->
<!-- ============================================================ -->
<g filter="url(#glowBlue)">
  <rect x="1040" y="280" width="300" height="80" rx="10" fill="url(#gradBlue)" filter="url(#shadowSmall)"/>
  <text x="1190" y="312" text-anchor="middle" fill="#fff" font-size="15" font-weight="700">Results</text>
  <text x="1190" y="333" text-anchor="middle" fill="#fff" font-size="11" font-weight="500" opacity="0.85">+ Pre-computed Descriptions</text>
</g>

<!-- ============================================================ -->
<!-- CONNECTIONS (arrows)                                           -->
<!-- ============================================================ -->

<!-- Query Image → CLIP Embed -->
<path d="M 180,285 C 200,285 205,157 228,157" fill="none" stroke="#fb7185" stroke-width="2" marker-end="url(#arrowRed)" opacity="0.8"/>

<!-- Query Image → pHash Compute -->
<path d="M 180,300 L 200,300 C 210,300 210,232 228,232" fill="none" stroke="#00d2a0" stroke-width="2" marker-end="url(#arrowGreen)" opacity="0.8"/>

<!-- Query Image → is_grayscale() -->
<path d="M 180,315 C 200,315 205,452 228,452" fill="none" stroke="#00d2a0" stroke-width="2" marker-end="url(#arrowGreen)" opacity="0.8"/>

<!-- CLIP Embed → Qdrant ANN Search -->
<path d="M 393,157 L 420,157" fill="none" stroke="#a78bfa" stroke-width="2" marker-end="url(#arrowPurple)" opacity="0.8"/>

<!-- Qdrant ANN Search → Re-rank (right, into card 3) -->
<path d="M 550,157 C 600,157 600,185 650,185 L 780,185 C 900,185 950,190 1040,190" fill="none" stroke="#a78bfa" stroke-width="1.5" marker-end="url(#arrowPurple)" opacity="0.6" stroke-dasharray="6,3"/>
<!-- Label: top_k candidates -->
<text x="830" y="178" text-anchor="middle" fill="#a78bfa" font-size="9" font-weight="500" opacity="0.7">top_k candidates</text>

<!-- pHash Compute → Re-rank -->
<path d="M 393,232 C 500,232 600,200 750,200 C 880,200 950,195 1040,195" fill="none" stroke="#00d2a0" stroke-width="1.5" marker-end="url(#arrowGreen)" opacity="0.6" stroke-dasharray="6,3"/>
<!-- Label: hash value -->
<text x="680" y="222" text-anchor="middle" fill="#00d2a0" font-size="9" font-weight="500" opacity="0.7">hash value</text>

<!-- is_grayscale() → Diamond (Color Mismatch?) -->
<path d="M 393,452 C 500,452 600,480 650,490 L 710,500" fill="none" stroke="#fbbf24" stroke-width="2" marker-end="url(#arrowOrange)" opacity="0.8"/>

<!-- Diamond "Same" → 60% CLIP / 40% pHash (upward) -->
<path d="M 790,440 C 790,400 760,370 717,355" fill="none" stroke="#00d2a0" stroke-width="2" marker-end="url(#arrowGreen)" opacity="0.8"/>
<!-- Label: Same -->
<text x="770" y="393" text-anchor="middle" fill="#00d2a0" font-size="11" font-weight="600">Same</text>

<!-- Diamond "Different" → 85% CLIP / 15% pHash (upward far) -->
<path d="M 790,440 C 790,370 750,280 717,215" fill="none" stroke="#fb7185" stroke-width="2" marker-end="url(#arrowRed)" opacity="0.8"/>
<!-- Label: Different -->
<text x="770" y="282" text-anchor="middle" fill="#fb7185" font-size="11" font-weight="600">Different</text>

<!-- 60% CLIP / 40% pHash → Re-rank -->
<path d="M 790,325 C 900,325 950,210 1040,200" fill="none" stroke="#22d3ee" stroke-width="2" marker-end="url(#arrowCyan)" opacity="0.7"/>

<!-- 85% CLIP / 15% pHash → Re-rank -->
<path d="M 790,185 C 900,185 950,190 1040,190" fill="none" stroke="#22d3ee" stroke-width="2" marker-end="url(#arrowCyan)" opacity="0.7"/>

<!-- Re-rank → Results -->
<path d="M 1127,225 L 1127,280" fill="none" stroke="#4facfe" stroke-width="2.5" marker-end="url(#arrowBlue)" opacity="0.8"/>

<!-- ============================================================ -->
<!-- TIMING ANNOTATIONS                                            -->
<!-- ============================================================ -->
<rect x="228" y="275" width="95" height="22" rx="4" fill="#1a2744" stroke="#1e3a5f" stroke-width="0.5"/>
<text x="275" y="290" text-anchor="middle" fill="#64748b" font-size="9" font-weight="500">~15 ms</text>

<rect x="420" y="200" width="95" height="22" rx="4" fill="#1a2744" stroke="#1e3a5f" stroke-width="0.5"/>
<text x="467" y="215" text-anchor="middle" fill="#64748b" font-size="9" font-weight="500">~5 ms (ANN)</text>

<rect x="1040" y="240" width="95" height="22" rx="4" fill="#1a2744" stroke="#1e3a5f" stroke-width="0.5"/>
<text x="1087" y="255" text-anchor="middle" fill="#64748b" font-size="9" font-weight="500">~2 ms</text>

<rect x="1040" y="375" width="105" height="22" rx="4" fill="#1a2744" stroke="#1e3a5f" stroke-width="0.5"/>
<text x="1092" y="390" text-anchor="middle" fill="#64748b" font-size="9" font-weight="500">~25 ms total</text>

<!-- ============================================================ -->
<!-- LEGEND                                                        -->
<!-- ============================================================ -->
<rect x="30" y="540" width="150" height="140" rx="8" fill="url(#cardBlue)" stroke="#1e3a5f" stroke-width="1" filter="url(#shadowSmall)"/>
<text x="105" y="562" text-anchor="middle" fill="#94a3b8" font-size="10" font-weight="600" letter-spacing="1.5">LEGEND</text>

<!-- Legend items -->
<rect x="44" y="574" width="10" height="10" rx="2" fill="url(#gradOrange)"/>
<text x="62" y="584" fill="#cbd5e1" font-size="10">Input</text>

<rect x="44" y="594" width="10" height="10" rx="2" fill="url(#gradRed)"/>
<text x="62" y="604" fill="#cbd5e1" font-size="10">CLIP Model</text>

<rect x="44" y="614" width="10" height="10" rx="2" fill="url(#gradGreen)"/>
<text x="62" y="624" fill="#cbd5e1" font-size="10">Hashing / Scoring</text>

<rect x="44" y="634" width="10" height="10" rx="2" fill="url(#gradPurple)"/>
<text x="62" y="644" fill="#cbd5e1" font-size="10">Vector DB</text>

<rect x="44" y="654" width="10" height="10" rx="2" fill="url(#gradCyan)"/>
<text x="62" y="664" fill="#cbd5e1" font-size="10">Re-ranking</text>

<!-- ============================================================ -->
<!-- PIPELINE SUMMARY (bottom right)                               -->
<!-- ============================================================ -->
<rect x="1010" y="460" width="360" height="90" rx="8" fill="url(#cardBlue)" stroke="#1e3a5f" stroke-width="1" filter="url(#shadowSmall)"/>
<text x="1190" y="485" text-anchor="middle" fill="#94a3b8" font-size="10" font-weight="600" letter-spacing="1.5">PIPELINE SUMMARY</text>
<text x="1190" y="506" text-anchor="middle" fill="#cbd5e1" font-size="11">Qdrant pre-filters by tags (color, source, date)</text>
<text x="1190" y="522" text-anchor="middle" fill="#cbd5e1" font-size="11">CLIP + pHash re-rank with adaptive weights</text>
<text x="1190" y="538" text-anchor="middle" fill="#fbbf24" font-size="11" font-weight="600">End-to-end latency: ~25 ms</text>

<!-- ============================================================ -->
<!-- BOTTOM DECORATIVE LINE                                        -->
<!-- ============================================================ -->
<line x1="30" y1="680" x2="1370" y2="680" stroke="#1e3a5f" stroke-width="1" opacity="0.3"/>
<text x="700" y="695" text-anchor="middle" fill="#334155" font-size="9" letter-spacing="2">PIKAMATCH SEARCH PIPELINE v3.0</text>

</svg>